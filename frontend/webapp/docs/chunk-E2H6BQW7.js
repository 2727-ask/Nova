import{a as S}from"./chunk-2635VMHW.js";import{a as Q}from"./chunk-MJI75GYL.js";import{A as d,B as m,D as R,E as T,F,G as B,H as D,N as q,P as N,e as s,h as A,i as h,j as b,k as e,l as i,m as C,r as P,s as y,t as E,u as _,w as I,x as t,y as x,z as p}from"./chunk-NIEHQPVU.js";var V=["beforeAfterChart"],L=["totalsChart"],z=["categoryDeltaChart"];function Y(c,r){if(c&1&&(e(0,"div"),t(1," Offset required after actions: "),e(2,"strong"),t(3),d(4,"number"),i()()),c&2){let n=P();s(3),p("",m(4,1,n.offsetKg,"1.2-2")," kg")}}function Z(c,r){if(c&1&&(e(0,"div",22)(1,"h4",23),t(2,"Compensation & Offsetting suggestions"),i(),e(3,"p"),t(4,"Your projected emissions are still above the allotted budget. You can compensate by buying verified carbon credits or supporting tree-planting programs."),i(),e(5,"ul")(6,"li"),t(7,"Estimated offset required: "),e(8,"strong"),t(9),d(10,"number"),i()(),e(11,"li"),t(12,"Approx. carbon credits cost: "),e(13,"strong"),t(14),d(15,"number"),i(),t(16," (estimate at ~$10 / tonne)"),i(),e(17,"li"),t(18,"Approx. number of trees to plant: "),e(19,"strong"),t(20),i(),t(21," (varies by species & location)"),i()(),e(22,"div",24)(23,"a",25),t(24,"Buy Verified Credits"),i(),e(25,"a",26),t(26,"Plant Trees"),i()(),e(27,"h5",27),t(28,"Compensation plan (simple)"),i(),e(29,"ol")(30,"li"),t(31,"Apply suggested reductions above to cut the largest category emissions first."),i(),e(32,"li"),t(33,"Purchase offsets to cover remaining gap (one-off or recurring)."),i(),e(34,"li"),t(35,"Plant trees or support habitat restoration projects for long-term sequestration."),i(),e(36,"li"),t(37,"Track next-month and re-evaluate \u2014 aim to be compliant within 3 months."),i()()()),c&2){let n=P();s(9),p("",m(10,3,n.offsetKg,"1.2-2")," kg"),s(5),p("\\$",m(15,6,n.estimatedCreditCostUsd,"1.2-2")),s(6),x(n.estimatedTrees)}}function G(c,r){if(c&1&&(e(0,"li"),t(1),i()),c&2){let n=r.$implicit;s(),x(n)}}function J(c,r){if(c&1&&(e(0,"div",28)(1,"div",29)(2,"div",30),t(3),i(),e(4,"div",31),t(5),d(6,"number"),e(7,"strong"),t(8),d(9,"number"),i()()(),e(10,"div",32),t(11),d(12,"number"),i(),e(13,"ul"),h(14,G,2,1,"li",33),i()()),c&2){let n=r.$implicit;s(3),x(n.name),s(2),p("",m(6,5,n.emission,"1.0-2")," kg \u2192 "),s(3),p("",m(9,8,n.afterEmission,"1.0-2")," kg"),s(3),p("Reduce by ",m(12,11,n.suggestionPct*100,"1.0-0"),"%"),s(3),b("ngForOf",n.tips)}}var j=class c{response=null;categories=[];totals={allotted:0,actual:0,delta:0,afterActual:0};compliant=!1;overallReductionPct=0;offsetKg=0;estimatedCreditCostUsd=0;estimatedTrees=0;beforeAfterChartEl;totalsChartEl;categoryDeltaChartEl;charts=[];suggestionsMap={Finances:{pct:.25,tips:["Consolidate loans","Switch to digital statements","Avoid late fees"]},Food:{pct:.15,tips:["Choose plant-forward meals","Plan grocery trips","Buy seasonal/local produce"]},Shopping:{pct:.35,tips:["Buy less, choose durable","Prefer second-hand","Avoid fast-fashion & bulk shipping"]},Travel:{pct:.4,tips:["Use public transit / bike","Combine errands","Choose EV / carpool"]},Housing:{pct:.2,tips:["Fix leaks","Install low-flow fixtures","Reduce hot water use"]},Health:{pct:.1,tips:["Telehealth where possible","Choose low-packaging products"]},Entertainment:{pct:.2,tips:["Stream Smart (lower quality)","Share subscriptions"]},Charity:{pct:0,tips:["Keep charitable giving but favour low-overhead options"]},default:{pct:.15,tips:["Review subscriptions","Reduce single-use purchases"]}};constructor(){R(()=>{let r=Q();if(r){this.response=r,this.prepareData(),this.destroyCharts();try{this.createChartsIfReady()}catch{}}})}ngOnInit(){}ngAfterViewInit(){this.createChartsIfReady()}createChartsIfReady(){this.response&&(this.createBeforeAfterChart(),this.createTotalsChart(),this.createCategoryDeltaChart())}destroyCharts(){this.charts.forEach(r=>{try{r.destroy()}catch{}}),this.charts=[]}prepareData(){this.categories=[];let r=this.response?.summary||{},n=0;for(let[f,u]of Object.entries(r)){let O=0,v=0;for(let[W,k]of Object.entries(u)){let H=Number(k.amount)||0,U=Number(k.emission)||0;O+=H,v+=U}let M=this.suggestionsMap[f]??this.suggestionsMap?.default,w=M.pct,$=+(v*(1-w));this.categories.push({name:f,amount:O,emission:+v,suggestionPct:w,afterEmission:+$,tips:M.tips}),n+=v}let a=this.response?.totals||{},l=Number(a.total_allotted_emission)||0,o=Number(a.total_actual_emission)||n||0,g=this.categories.reduce((f,u)=>f+u.afterEmission,0),K=l-o;this.totals={allotted:l,actual:o,delta:K,afterActual:g},this.compliant=o<=l,this.overallReductionPct=o>0?(o-g)/o*100:0,this.offsetKg=Math.max(0,g-l),this.estimatedCreditCostUsd=+(this.offsetKg*.01),this.estimatedTrees=Math.ceil(this.offsetKg>0?this.offsetKg/22:0),this.categories.sort((f,u)=>u.emission-f.emission)}createBeforeAfterChart(){if(!this.beforeAfterChartEl)return;let r=this.categories.map(o=>o.name),n=this.categories.map(o=>o.emission),a=this.categories.map(o=>o.afterEmission),l=this.beforeAfterChartEl.nativeElement.getContext("2d");this.charts.push(new S(l,{type:"bar",data:{labels:r,datasets:[{label:"Before (kg)",data:n,backgroundColor:this.generateColors(n.length,.7)},{label:"After (kg)",data:a,backgroundColor:this.generateColors(a.length,.25)}]},options:{responsive:!0,plugins:{legend:{position:"bottom"}},scales:{y:{beginAtZero:!0}}}}))}createTotalsChart(){if(!this.totalsChartEl)return;let r=this.totalsChartEl.nativeElement.getContext("2d"),n=["Allotted","Actual","After (projected)"],a=[this.totals.allotted,this.totals.actual,this.totals.afterActual];this.charts.push(new S(r,{type:"doughnut",data:{labels:n,datasets:[{data:a,backgroundColor:["#109618","#dc3912","#3366cc"]}]},options:{plugins:{legend:{position:"bottom"}}}}))}createCategoryDeltaChart(){if(!this.categoryDeltaChartEl)return;let r=this.categories.map(o=>o.name),n=this.categories.map(o=>+(o.afterEmission-o.emission).toFixed(2)),a=n.map(o=>o<0?"#109618":"#b82e2e"),l=this.categoryDeltaChartEl.nativeElement.getContext("2d");this.charts.push(new S(l,{type:"bar",data:{labels:r,datasets:[{label:"Delta (after - before)",data:n,backgroundColor:a}]},options:{plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}}))}generateColors(r,n=1){let a=["#3366cc","#dc3912","#ff9900","#109618","#990099","#3b3eac","#0099c6","#dd4477","#66aa00","#b82e2e"];return Array.from({length:r},(l,o)=>{let g=a[o%a.length];return n===1?g:this.hexToRgba(g,n)})}hexToRgba(r,n){let a=parseInt(r.slice(1,3),16),l=parseInt(r.slice(3,5),16),o=parseInt(r.slice(5,7),16);return`rgba(${a},${l},${o},${n})`}static \u0275fac=function(n){return new(n||c)};static \u0275cmp=A({type:c,selectors:[["app-final"]],viewQuery:function(n,a){if(n&1&&(y(V,5),y(L,5),y(z,5)),n&2){let l;E(l=_())&&(a.beforeAfterChartEl=l.first),E(l=_())&&(a.totalsChartEl=l.first),E(l=_())&&(a.categoryDeltaChartEl=l.first)}},decls:71,vars:24,consts:[["beforeAfterChart",""],["totalsChart",""],["categoryDeltaChart",""],[1,"final-root"],[1,"hero"],[1,"left"],[1,"badge"],[1,"sub"],[1,"summary"],[1,"quick-metrics"],[4,"ngIf"],["class","offset-card chart-card",4,"ngIf"],[1,"charts"],[1,"chart-card"],[1,"chart-row"],[1,"chart-card","small"],[1,"right"],[1,"cards"],["class","cat-card","style","padding: 20px;",4,"ngFor","ngForOf"],[1,"final-cta"],["routerLink","/optimizing",1,"btn-primary"],[1,"more"],[1,"offset-card","chart-card"],[2,"margin-top","0"],[1,"comp-actions"],["href","https://www.goldstandard.org/","target","_blank","rel","noopener",1,"btn-primary"],["href","https://onetreeplanted.org/","target","_blank","rel","noopener",1,"btn-primary",2,"margin-left","8px"],[2,"margin-top","12px"],[1,"cat-card",2,"padding","20px"],[1,"cat-header"],[1,"cat-name"],[1,"impact"],[1,"pct"],[4,"ngFor","ngForOf"]],template:function(n,a){n&1&&(e(0,"div",3)(1,"div",4)(2,"div",5)(3,"h2"),t(4,"Recommended improvements"),i(),e(5,"div",6)(6,"strong"),t(7),i(),e(8,"div",7),t(9,"Allotted vs actual"),i()(),e(10,"div",8)(11,"div"),t(12,"Total allotted: "),e(13,"strong"),t(14),d(15,"number"),i()(),e(16,"div"),t(17,"Total actual: "),e(18,"strong"),t(19),d(20,"number"),i()(),e(21,"div"),t(22,"Projected after changes: "),e(23,"strong"),t(24),d(25,"number"),i()()(),e(26,"div",9)(27,"div"),t(28,"Overall projected reduction: "),e(29,"strong"),t(30),d(31,"number"),i()(),h(32,Y,5,4,"div",10),i(),h(33,Z,38,9,"div",11),e(34,"div",12)(35,"div",13)(36,"h4"),t(37,"Before vs After (by category)"),i(),C(38,"canvas",null,0),i(),e(40,"div",14)(41,"div",15)(42,"h4"),t(43,"Totals"),i(),C(44,"canvas",null,1),i(),e(46,"div",15)(47,"h4"),t(48,"Reduction per category"),i(),C(49,"canvas",null,2),i()()()(),e(51,"div",16)(52,"h3"),t(53,"Actionable tips (by category)"),i(),e(54,"div",17),h(55,J,15,14,"div",18),i(),e(56,"div",19)(57,"button",20),t(58,"Apply suggestions & simulate"),i()()()(),e(59,"section",21)(60,"h4"),t(61,"Quick wins"),i(),e(62,"ul")(63,"li"),t(64,"Switch to paperless billing and consolidate accounts (reduces finance emissions)"),i(),e(65,"li"),t(66,"Plan groceries & prefer plant-forward meals (food)"),i(),e(67,"li"),t(68,"Reduce e-commerce frequency and combine deliveries (shopping)"),i(),e(69,"li"),t(70,"Use ride-sharing smartly, bike or public transit when possible (travel)"),i()()()()),n&2&&(s(5),I("ok",a.compliant)("warn",!a.compliant),s(2),x(a.compliant?"Compliant":"Not compliant"),s(7),p("",m(15,12,a.totals.allotted,"1.0-2")," kg"),s(5),p("",m(20,15,a.totals.actual,"1.0-2")," kg"),s(5),p("",m(25,18,a.totals.afterActual,"1.0-2")," kg"),s(6),p("",m(31,21,a.overallReductionPct,"1.0-0"),"%"),s(2),b("ngIf",!a.compliant),s(),b("ngIf",!a.compliant),s(22),b("ngForOf",a.categories))},dependencies:[D,T,F,N,q,B],styles:[".final-root[_ngcontent-%COMP%]{padding:20px;color:#e6efe0;background:#000;min-height:100vh;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial}.hero[_ngcontent-%COMP%]{display:flex;gap:20px;align-items:flex-start}.left[_ngcontent-%COMP%]{flex:1 1 60%}.right[_ngcontent-%COMP%]{flex:1 1 38%}.badge[_ngcontent-%COMP%]{display:inline-block;padding:10px 12px;border-radius:10px;margin:8px 0;background:#2b2b2b;color:#fff}.badge.ok[_ngcontent-%COMP%]{background:linear-gradient(90deg,#0f8b2b,#2da84a)}.badge.warn[_ngcontent-%COMP%]{background:linear-gradient(90deg,#b82e2e,#ff7043)}.summary[_ngcontent-%COMP%]{display:flex;gap:12px;margin:8px 0 16px;flex-wrap:wrap}.chart-card[_ngcontent-%COMP%]{background:#0f1113;padding:12px;border-radius:10px;margin-bottom:12px;box-shadow:0 6px 18px #0009}.chart-row[_ngcontent-%COMP%]{display:flex;gap:12px}.chart-card.small[_ngcontent-%COMP%]{flex:1 1 0}.right[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:12px;color:#90c17b}.cards[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.cat-card[_ngcontent-%COMP%]{background:linear-gradient(180deg,#0c0f10,#121212);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.03)}.cat-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}.cat-name[_ngcontent-%COMP%]{font-weight:600;color:#dfeee0}.impact[_ngcontent-%COMP%]{font-size:13px;color:#bfcfc0}.pct[_ngcontent-%COMP%]{color:#90c17b;font-weight:600;margin-bottom:6px}.final-cta[_ngcontent-%COMP%]{margin-top:12px}.more[_ngcontent-%COMP%]{margin-top:22px}.more[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{color:#d0e0c9}.btn-primary[_ngcontent-%COMP%]{background:#447131;color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}.quick-metrics[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:10px;color:#cfe7c6}.offset-card[_ngcontent-%COMP%]{background:linear-gradient(180deg,#111,#0b0b0b);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,.03);margin-top:12px}.comp-actions[_ngcontent-%COMP%]{margin-top:8px}.comp-actions[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{text-decoration:none;display:inline-block;padding:8px 10px;border-radius:6px}"]})};export{j as Final};
