import{a as f}from"./chunk-2635VMHW.js";import{a as B}from"./chunk-MJI75GYL.js";import{A as u,B as g,D as M,E as w,F as I,G as P,H as z,N as T,P as D,e as s,h as O,i as E,j as p,k as e,l as t,m as c,s as h,t as b,u as C,x as n,y as d,z as x}from"./chunk-NIEHQPVU.js";var Q=["categoryAmountChart"],L=["categoryEmissionChart"],$=["subcategoryAmountChart"],F=["totalsChart"],H=["budgetComparisonChart"],q=["deltaChart"];function j(l,o){if(l&1&&(e(0,"tr")(1,"td"),n(2),t(),e(3,"td"),n(4),u(5,"number"),t(),e(6,"td",26),n(7),u(8,"number"),t()()),l&2){let i=o.$implicit;s(2),d(i.name),s(2),x("$",g(5,3,i.amount,"1.2-2")),s(3),d(g(8,6,i.emission,"1.2-2"))}}function V(l,o){if(l&1&&(e(0,"tr")(1,"td"),n(2),t(),e(3,"td"),n(4),t(),e(5,"td"),n(6),u(7,"number"),t(),e(8,"td",26),n(9),u(10,"number"),t()()),l&2){let i=o.$implicit;s(2),d(i.category),s(2),d(i.name),s(2),x("$",g(7,4,i.amount,"1.2-2")),s(3),d(g(10,7,i.emission,"1.2-2"))}}function U(l,o){l&1&&(e(0,"span",31),n(1,"Over"),t())}function Z(l,o){l&1&&(e(0,"span",32),n(1,"Under"),t())}function G(l,o){l&1&&(e(0,"span"),n(1,"On target"),t())}function J(l,o){if(l&1&&(e(0,"tr")(1,"td"),n(2),t(),e(3,"td"),n(4),u(5,"number"),t(),e(6,"td"),n(7),u(8,"number"),t(),e(9,"td"),n(10),u(11,"number"),t(),e(12,"td"),E(13,U,2,0,"span",28)(14,Z,2,0,"span",29)(15,G,2,0,"span",30),t()()),l&2){let i=o.$implicit;s(2),d(i.key),s(2),d(g(5,7,i.value.budgeted_kg,"1.2-2")),s(3),d(g(8,10,i.value.actual_kg,"1.2-2")),s(3),d(g(11,13,i.value.delta_kg,"1.2-2")),s(3),p("ngIf",i.value.status==="over"),s(),p("ngIf",i.value.status==="under"),s(),p("ngIf",i.value.status==="on_target")}}var R=class l{response=null;categories=[];subcategories=[];categoryAmountChartEl;categoryEmissionChartEl;subcategoryAmountChartEl;totalsChartEl;budgetComparisonChartEl;deltaChartEl;charts=[];viewInitialized=!1;budgetCategories=[];budgetBudgeted=[];budgetActual=[];budgetDelta=[];budgetEntries=[];constructor(){M(()=>{let o=B();o&&(this.response=o,this.categories=[],this.subcategories=[],this.budgetCategories=[],this.budgetBudgeted=[],this.budgetActual=[],this.budgetDelta=[],this.budgetEntries=[],this.prepareData(),this.viewInitialized&&(this.destroyCharts(),this.createCategoryAmountChart(),this.createCategoryEmissionChart(),this.createSubcategoryAmountChart(),this.createTotalsChart(),this.createBudgetComparisonChart(),this.createDeltaChart()))})}destroyCharts(){this.charts.forEach(o=>{try{o.destroy()}catch{}}),this.charts=[]}prepareData(){let o=this.response?.summary||{};for(let[a,r]of Object.entries(o)){let m=0,y=0;for(let[v,_]of Object.entries(r)){let{amount:S,emission:N}=_,A=Number(S)||0,k=Number(N)||0;m+=A,y+=k,this.subcategories.push({category:a,name:v,amount:A,emission:k})}this.categories.push({name:a,amount:m,emission:y})}this.categories.sort((a,r)=>r.amount-a.amount),this.subcategories.sort((a,r)=>r.amount-a.amount);let i=this.response?.budget_comparison_by_category||{};for(let[a,r]of Object.entries(i)){let m=Number(r.budgeted_kg)||0,y=Number(r.actual_kg)||0,v=Number(r.delta_kg)||0,_=Number(r.delta_pct)||0,S=String(r.status||"");this.budgetCategories.push(a),this.budgetBudgeted.push(m),this.budgetActual.push(y),this.budgetDelta.push(v),this.budgetEntries.push({key:a,value:{budgeted_kg:m,actual_kg:y,delta_kg:v,delta_pct:_,status:S}})}}ngAfterViewInit(){this.viewInitialized=!0,this.response&&(this.createCategoryAmountChart(),this.createCategoryEmissionChart(),this.createSubcategoryAmountChart(),this.createTotalsChart(),this.createBudgetComparisonChart(),this.createDeltaChart())}createCategoryAmountChart(){let o=this.categories.map(r=>r.name),i=this.categories.map(r=>r.amount),a=this.categoryAmountChartEl.nativeElement.getContext("2d");this.charts.push(new f(a,{type:"pie",data:{labels:o,datasets:[{data:i,backgroundColor:this.generateColors(o.length)}]},options:{plugins:{legend:{position:"right"}}}}))}createCategoryEmissionChart(){let o=this.categories.map(r=>r.name),i=this.categories.map(r=>r.emission),a=this.categoryEmissionChartEl.nativeElement.getContext("2d");this.charts.push(new f(a,{type:"pie",data:{labels:o,datasets:[{data:i,backgroundColor:this.generateColors(o.length)}]},options:{plugins:{legend:{position:"right"}}}}))}createSubcategoryAmountChart(){let o=this.subcategories.slice(0,8),i=o.map(m=>`${m.category} \u2014 ${m.name}`),a=o.map(m=>m.amount),r=this.subcategoryAmountChartEl.nativeElement.getContext("2d");this.charts.push(new f(r,{type:"pie",data:{labels:i,datasets:[{data:a,backgroundColor:this.generateColors(i.length)}]},options:{plugins:{legend:{position:"right"}}}}))}createTotalsChart(){let o=this.response?.totals||{total_allotted_emission:0,total_actual_emission:0},i=["Allotted (budget)","Actual"],a=[Number(o.total_allotted_emission)||0,Number(o.total_actual_emission)||0],r=this.totalsChartEl?.nativeElement.getContext("2d");r&&this.charts.push(new f(r,{type:"doughnut",data:{labels:i,datasets:[{data:a,backgroundColor:["#109618","#dc3912"]}]},options:{plugins:{legend:{position:"bottom"}}}}))}createBudgetComparisonChart(){if(!this.budgetCategories.length)return;let o=this.budgetComparisonChartEl.nativeElement.getContext("2d");this.charts.push(new f(o,{type:"bar",data:{labels:this.budgetCategories,datasets:[{label:"Budgeted (kg)",data:this.budgetBudgeted,backgroundColor:"#3366cc"},{label:"Actual (kg)",data:this.budgetActual,backgroundColor:"#ff9900"}]},options:{plugins:{legend:{position:"bottom"}},responsive:!0,scales:{x:{stacked:!1},y:{beginAtZero:!0}}}}))}createDeltaChart(){if(!this.budgetCategories.length)return;let o=this.budgetDelta.map(a=>a>0?"#b82e2e":"#109618"),i=this.deltaChartEl.nativeElement.getContext("2d");this.charts.push(new f(i,{type:"bar",data:{labels:this.budgetCategories,datasets:[{label:"Delta (kg)",data:this.budgetDelta,backgroundColor:o}]},options:{plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}}))}generateColors(o){let i=["#3366cc","#dc3912","#ff9900","#109618","#990099","#3b3eac","#0099c6","#dd4477","#66aa00","#b82e2e"],a=[];for(let r=0;r<o;r++)a.push(i[r%i.length]);return a}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=O({type:l,selectors:[["app-analyze"]],viewQuery:function(i,a){if(i&1&&(h(Q,5),h(L,5),h($,5),h(F,5),h(H,5),h(q,5)),i&2){let r;b(r=C())&&(a.categoryAmountChartEl=r.first),b(r=C())&&(a.categoryEmissionChartEl=r.first),b(r=C())&&(a.subcategoryAmountChartEl=r.first),b(r=C())&&(a.totalsChartEl=r.first),b(r=C())&&(a.budgetComparisonChartEl=r.first),b(r=C())&&(a.deltaChartEl=r.first)}},decls:119,vars:9,consts:[["categoryAmountChart",""],["categoryEmissionChart",""],["subcategoryAmountChart",""],["totalsChart",""],["budgetComparisonChart",""],["deltaChart",""],[1,"analyze-root"],[1,"text-white",2,"display","flex","gap","12px","align-items","center","justify-content","space-between"],[1,"title"],[1,"back"],["routerLink","/optimizing",1,"btn","btn-primary"],[1,"fa-solid","fa-check-circle"],[1,"meta"],[2,"display","flex","gap","12px","align-items","center"],[2,"background","#121212","padding","8px","border-radius","6px"],[1,"text-heading",2,"font-size","12px"],[2,"font-weight","600"],[1,"charts-row"],[1,"chart-card","card"],[1,"text-heading"],[2,"display","flex","justify-content","center","align-items","center"],[1,"chart-card","card","mt-2",2,"flex-basis","100%"],[2,"width","30px"],[1,"tables"],[1,"text-heading","mt-2"],[1,"table"],[2,"text-align","center"],[4,"ngFor","ngForOf"],["style","color: #b82e2e",4,"ngIf"],["style","color: #109618",4,"ngIf"],[4,"ngIf"],[2,"color","#b82e2e"],[2,"color","#109618"]],template:function(i,a){i&1&&(e(0,"div",6)(1,"div",7)(2,"div",8)(3,"h2"),n(4,"Analysis Summary"),t()(),e(5,"div",9)(6,"button",10),n(7," Reduce CO2 footprint\xA0\xA0"),c(8,"i",11),t()()(),e(9,"div",7)(10,"div",12)(11,"div"),n(12," Transactions: "),e(13,"strong"),n(14),t()(),e(15,"div"),n(16," Uncategorized: "),e(17,"strong"),n(18),t()(),e(19,"div"),n(20," Statement ID: "),e(21,"small"),n(22),t()()(),e(23,"div",13)(24,"div",14)(25,"div",15),n(26,"Total Allotted (kg)"),t(),e(27,"div",16),n(28),t()(),e(29,"div",14)(30,"div",15),n(31,"Total Actual (kg)"),t(),e(32,"div",16),n(33),t()(),e(34,"div",14)(35,"div",15),n(36,"Delta (kg)"),t(),e(37,"div",16),n(38),t()()()(),c(39,"br"),e(40,"section",17)(41,"div",18)(42,"h3",19),n(43,"Category - Amount"),t(),c(44,"canvas",null,0),t(),e(46,"div",18)(47,"h3",19),n(48,"Category - Emissions"),t(),c(49,"canvas",null,1),t(),e(51,"div",18)(52,"h3",19),n(53,"Top Subcategories - Amount"),t(),c(54,"canvas",null,2),t(),e(56,"div",18)(57,"h3",19),n(58,"Totals: Budget vs Actual"),t(),c(59,"canvas",null,3),t(),e(61,"div",20)(62,"div",21)(63,"h3",19),n(64,"Budget Comparison by Category"),t(),c(65,"canvas",null,4),t(),c(67,"div",22),e(68,"div",21)(69,"h3",19),n(70,"Delta by Category (actual - budget)"),t(),c(71,"canvas",null,5),t()()(),e(73,"section",23)(74,"h3",24),n(75,"Category Totals"),t(),e(76,"table",25)(77,"thead")(78,"tr")(79,"th"),n(80,"Category"),t(),e(81,"th"),n(82,"Amount"),t(),e(83,"th",26),n(84,"Emission (kg)"),t()()(),e(85,"tbody"),E(86,j,9,9,"tr",27),t()(),e(87,"h3",24),n(88,"Subcategories (top by amount)"),t(),e(89,"table",25)(90,"thead")(91,"tr")(92,"th"),n(93,"Category"),t(),e(94,"th"),n(95,"Subcategory"),t(),e(96,"th"),n(97,"Amount"),t(),e(98,"th",26),n(99,"Emission (kg)"),t()()(),e(100,"tbody"),E(101,V,11,10,"tr",27),t()(),e(102,"h3",24),n(103,"Budget Comparison (by category)"),t(),e(104,"table",25)(105,"thead")(106,"tr")(107,"th"),n(108,"Category"),t(),e(109,"th"),n(110,"Budgeted (kg)"),t(),e(111,"th"),n(112,"Actual (kg)"),t(),e(113,"th"),n(114,"Delta (kg)"),t(),e(115,"th"),n(116,"Status"),t()()(),e(117,"tbody"),E(118,J,16,16,"tr",27),t()()()()),i&2&&(s(14),d(a.response==null?null:a.response.transactions_count),s(4),x("$",a.response==null?null:a.response.uncategorized),s(4),d(a.response==null?null:a.response.statement_id),s(6),d(a.response==null||a.response.totals==null?null:a.response.totals.total_allotted_emission),s(5),d(a.response==null||a.response.totals==null?null:a.response.totals.total_actual_emission),s(5),d(a.response==null||a.response.totals==null?null:a.response.totals.delta_kg),s(48),p("ngForOf",a.categories),s(15),p("ngForOf",a.subcategories),s(17),p("ngForOf",a.budgetEntries))},dependencies:[z,w,I,D,T,P],styles:[".analyze-root[_ngcontent-%COMP%]{background:#121212}h2[_ngcontent-%COMP%]{color:#7ed957}.text-white[_ngcontent-%COMP%]{color:#fff}td[_ngcontent-%COMP%]{color:#999}thead[_ngcontent-%COMP%]{background:linear-gradient(30deg,#ffffff0d 20%,#0000 50%)!important}tr[_ngcontent-%COMP%]{color:#e0e0e0;background:linear-gradient(30deg,#ffffff0d 20%,#0000 50%)!important}.text-heading[_ngcontent-%COMP%]{color:#90c17b}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background:linear-gradient(30deg,#ffffff0d 20%,#0000 50%)!important}.mt-2[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:6px}.card[_ngcontent-%COMP%]{z-index:3;border-radius:20px;background:linear-gradient(30deg,#ffffff0d 20%,#0000 50%)!important}.analyze-root[_ngcontent-%COMP%]{padding:16px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial}.meta[_ngcontent-%COMP%]{display:flex;gap:24px;margin-bottom:12px}.charts-row[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:20px}.charts-row[_ngcontent-%COMP%]   .chart-card[_ngcontent-%COMP%]{flex:1 1 320px;background:#fff;border-radius:6px;padding:12px;box-shadow:0 1px 3px #0000000f}.charts-row[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{max-width:100%;height:240px}.tables[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:16px}.tables[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tables[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px 10px;text-align:left}"]})};export{R as Analyze};
